<!DOCTYPE html>
<html>
<body>

	<object data="diag-data.svg" type="image/svg+xml" width="800" height="600" id="svg-diag-data">
		Your browser does not support SVGs
	</object>

	<script type="text/javascript">
	
		 var mySVG = document.getElementById("svg-diag-data");
		 var frameSize = mySVG.width;
		 var svgDoc;
		 mySVG.addEventListener("load",function() {
			svgDoc = mySVG.contentDocument;		    
			
			var dates = new Array();
			collectAllDates(svgDoc, dates);
			
			var minDate = minDate(dates);
			var maxDate = maxDate(dates);

			var range = maxDate.getTime() - minDate.getTime();
			var ratio = frameSize/range;

			validationTimePlacement(svgDoc);
			certificatesHorizontalPlacement(svgDoc);
			displayLeafs(svgDoc);
			signaturesPlacement(svgDoc);
			timestampsPlacement(svgDoc);
			
			function validationTimePlacement(completeSvg) {
	 			var validationTimeElement = completeSvg.getElementById("svg-validation-time");
 				var validationTime = new Date(validationTimeElement.getElementsByTagName("title")[0].textContent);
 				var pos_validation_time = (validationTime.getTime() - minDate.getTime()) * ratio;
 				validationTimeElement.setAttribute("x", pos_validation_time);
			}
			
			function certificatesHorizontalPlacement(completeSvg) {
	 			var elements = completeSvg.getElementsByClassName("svg-certificate");
	 			for (i = 0; i < elements.length; i++) {
	 				var currentElement = elements[i];
	 				
	 				var notBefore = new Date(currentElement.getElementsByClassName("svg-not-before")[0].textContent);
	 				var notAfter = new Date(currentElement.getElementsByClassName("svg-not-after")[0].textContent);
	 				var pos_x_certificate = (notBefore.getTime() - minDate.getTime()) * ratio;
	 				var width_cer = (notAfter.getTime() - notBefore.getTime()) * ratio;
	 				currentElement.setAttribute("x", Math.round(pos_x_certificate));
	 				currentElement.setAttribute("width", Math.round(width_cer));
	 			}
			}
			
			function displayLeafs(completeSvg) {
				var leafIds = getLeafIds(completeSvg);
	 			var certElements = completeSvg.getElementsByClassName("svg-certificate");
	 			for (i = 0; i < certElements.length; i++) {
	 				var certElement = certElements[i];
	 				var certId = certElement.getAttribute("id");
	 				if (!leafIds.includes(certId)) {
	 					certElement.style.display = "none";
	 				}	else {
	 					certElement.setAttribute("y", ((i+1) *20));
	 				}
	 			}
			}
			
			function getLeafIds(completeSvg) {
	 			var leafElements = completeSvg.getElementsByClassName("leaf");
	 			var leafIds = new Array();
	 			for (i = 0; i < leafElements.length; i++) {
	 				var leafElement = leafElements[i];
	 				leafIds.push(leafElement.textContent);
	 			}
	 			return leafIds;
			}
			
			function signaturesPlacement(completeSvg) {
	 			var elements = completeSvg.getElementsByClassName("svg-signature");
	 			for (i = 0; i < elements.length; i++) {
	 				var currentElement = elements[i];
	 				var claimedSigningTime = new Date(currentElement.getElementsByClassName("svg-claimed-signing-time")[0].textContent);
	 				var pos_signature = (claimedSigningTime.getTime() - minDate.getTime()) * ratio;
	 				currentElement.setAttribute("x", pos_signature);
	 				
	 				var sigCertId = currentElement.getElementsByClassName("svg-signing-cert")[0].textContent;
	 				var sigCertElement = completeSvg.getElementById(sigCertId);
	 				currentElement.setAttribute("y", sigCertElement.getAttribute("y"));
	 			}
			}
			
			function timestampsPlacement(completeSvg) {
	 			var elements = completeSvg.getElementsByClassName("svg-timestamp");
	 			for (i = 0; i < elements.length; i++) {
	 				var currentElement = elements[i];
	 				var productionTime = new Date(currentElement.getElementsByClassName("svg-production-time")[0].textContent);
	 				var pos_timestamp = (productionTime.getTime() - minDate.getTime()) * ratio;
	 				currentElement.setAttribute("x", pos_timestamp);

	 				var sigCertId = currentElement.getElementsByClassName("svg-signing-cert")[0].textContent;
	 				var sigCertElement = completeSvg.getElementById(sigCertId);
	 				currentElement.setAttribute("y", sigCertElement.getAttribute("y"));
	 			}
			}
			

	 		function collectAllDates(completeSvg, result) {
	 			var elements = completeSvg.getElementsByClassName("date");
	 			for (i = 0; i < elements.length; i++) {
					result.push(new Date(elements[i].textContent));
				}
			}
			
	 		function minDate(dates) {
				var minimalDate = null;
				for (i = 0; i < dates.length; i++) {
					var currentDate = dates[i];
					if (minimalDate == null || minimalDate > currentDate) {
						minimalDate = currentDate;
					}
				}
				return minimalDate;
			}
	 			
	 		function maxDate(dates) {
				var maximalDate = null;
				for (i = 0; i < dates.length; i++) {
					var currentDate = dates[i];
					if (maximalDate == null || maximalDate < currentDate) {
						maximalDate = currentDate;
					}
				}
				return maximalDate;
			}
		      
		 }, false);
	
	</script>

</body>
</html>